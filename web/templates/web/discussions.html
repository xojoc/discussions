{% extends "web/base.html" %}

{% load humanize %}
{% load util %}

{% block title %}
{% if ctx.title or ctx.original_query %}
{% firstof ctx.title ctx.original_query %} - discussions
{% else %}
Discussions around the Web
{% endif %}
{% endblock title %}

{% block meta_description %}
{% if ctx.title or ctx.original_query %}
Discussions and related articles for {% firstof ctx.title ctx.original_query %}
{% else %}
Find interesting discussions on Hacker News, Reddit and Lobsters for a given URL, title or keyword
{% endif %}
{% endblock meta_description %}

{% block extra_head %}
{% if ctx.link_canonical_url %}
<link rel="canonical" href="{{ctx.link_canonical_url}}" />
{% endif %}
{% endblock extra_head %}


{% block main %}
<!--
     "{{ctx.title}}"
     "{{ctx.original_query}}"
-->

<!--
     <form method="GET" class="discussions_form" action="/">
     {{ ctx.form.as_ul }}
     <input type="submit" value="Find discussions" />
     </form>
-->


<div id=discussions>
	<form method="GET" class="discussions_form" action="/">
		<div class="flex-container">
			<div class="flex-container input-submit">
				<input class="flex-fill-width" id="q" name="q" type="text" autofocus
					onfocus="this.selectionStart = this.selectionEnd = this.value.length;"
					value="{{ctx.original_query}}" placeholder="URL or title" />
				<input type="submit" value="Find discussions" />
			</div>
		</div>
	</form>


	<!--
	 SQL query:

	 {{ctx.sql_query}}
    -->

	{% if ctx.nothing_found %}
	<h2>Discussions not found</h2>
	<p>Sorry, we couldn't find nothing for <span class="bold">{{ctx.url}}</span></p>
	{% else %}

	{% if ctx.display_discussions %}

	{% comment %}
	{% if ctx.is_url %}

	<h2>{{ctx.title}}</h2>
	<span class="discussions_story_url"><a href="{{ctx.absolute_url}}" title="{{ctx.title}}"
			rel="nofollow">{{ctx.absolute_url}}</a>
	</span>
	<ul class="list-no-style">
		{% for d in ctx.discussions %}
		<li><span class="bold">{{d.platform_name}}</span>: <a href="{{d.discussion_url}}"
				title="{{d.platform_name}}: {{d.title}}" rel="nofollow"><span class="bold">{{d.comment_count}}</span>
				comment{{d.comment_count|pluralize:",s"}}</a> <span class="smaller-font">{{d.score}}
				{{d.score_label}}
				[<time datetime="{{d.created_at | date:'c'}}">{{d.created_at | date}}</time>]
				{% if d.tags %}
				{% for tag in d.tags %}
				{{tag}}{% if not forloop.last %}, {% endif %}
				{% endfor %}
				{% endif %}
			</span>

			<!--Id: {{d.platform_id}}
	 Normalized tags: {{d.normalized_tags}}
	 Normalized title: {{d.normalized_title}}
	 Canonical url: {{d.canonical_story_url}}
	-->
		</li>

		{% endfor %}
	</ul>

	{% else %}
	{% endcomment %}

	{% for platform, platform_name, platform_url, platform_tag_url, discussions in ctx.grouped_discussions %}
	<div id="platform_{{platform}}" class="platform_discussions">
		<h3>{{ platform_name }}</h3>
	</div>
	<ul>
		{% for d in discussions %}
		<li>{{d.title}} <span class="similar-search">(<a href="{{d.title|discussions_url}}"
					title="Discussions with similar title">Search by title</a>)</span>
			<br />
			<span class="discussions_story_url"><a href="{{d.story_url}}" title="{{d.title}}"
					rel="nofollow">{{d.story_url}}</a>
				<span class="similar-search">(<a href="{{d.story_url|discussions_url}}"
						title="Discussions and related pages for this URL">Lookup URL</a>)</span></span>
			<br />
			<!--
		 rel="noreferrer noopener" target="_blank"
	    -->

			<a href="{{d.discussion_url}}" title="View discussion on {{platform_name}}" rel="nofollow"><span
					class="bold">{{d.comment_count}}</span>
				comment{{d.comment_count|pluralize:",s"}}</a>, {{d.score}}
			{{d.score_label}}
			[<time datetime="{{d.created_at | date:'c'}}">{{d.created_at | date}}</time>]
			<span class="smaller-font">
				{% if d.tags %}
				{% if platform != 'r' %}
				Tags:
				{% endif %}
				{% for tag in d.tags %}
				{% comment %}
				{% if platform_tag_url %}
				<a href="{{platform_tag_url}}/{{tag}}" title="View tag «{{tag}}» on {{platform_name}}"
					rel="nofollow">{{tag}}</a>{% if not forloop.last %}, {% endif %}
				{% else %}
				{% endcomment %}
				{{tag}}{% if not forloop.last %}, {% endif %}

				{% endfor %}
				{% endif %}
			</span>

			<!--Id: {{d.platform_id}}
		 Normalized tags: {{d.normalized_tags}}
		 Normalized title: {{d.normalized_title}}
		 Canonical url: {{d.canonical_story_url}}
	    -->
		</li>

		{% endfor %}
	</ul>
	{% endfor %}



	{% else %}

	<br />
	<h2>What is discu.eu?</h2>
	<p>discu.eu tracks and makes accessible discussions on Hacker News, Lobsters, Reddit, Lambda the
		Ultimate and <a href="/statistics#platforms" title="Platforms">others</a>.
	</p>

	<h2>How to use</h2>
	<ul>
		<li><a href="{% url 'web:search' %}" title="How to search">Search by url or keyword</a></li>
		<li>Follow us on <a href="/social" title="Social accounts">Twitter or Mastodon</a> for daily updates on
			topics
			you care about</li>
		<li>Subscribe to the <a href="/weekly" title="Weekly newsletter">weekly newsletter</a> to get the latest on
			topics you
			care about</li>
		<li>Install the <a href="/extension" title="Browser extension">browser extension</a> to view discussions for the
			pages you visit (or use the <a href="/bookmarklet" title="Bookmarklet">bookmarklet</a>)</li>
		<li>Display comments on your <a href="/website" title="Display comments on your website">website</a></li>
		<li>Use the <a href="/api/v0/docs" title="Discussions API">API</a></li>
	</ul>

	{% endif %}

	{% endif %}



	<!-- Resource id: {{ctx.resource.id}} -->

	{% if ctx.inbound_resources %}

	<br />
	<h3>Related pages</h3>

	<div class="inbound_links">
		<ul>
			{% for inbound_resource in ctx.inbound_resources %}
			<!-- Inbound resource id: {{inbound_resource.id}} -->
			<li>{{inbound_resource.title}} <span class="similar-search">(<a
						href="{{inbound_resource.title|discussions_url}}" title="Discussions with similar title">Search
						by title</a>)</span>
				<br />
				<span class="discussions_story_url">
					<a href="{{inbound_resource.complete_url}}"
						title="{% firstof inbound_resource.title inbound_resource.complete_url %}"
						rel="nofollow">{{inbound_resource.complete_url}}</a>
				</span>
				<br />
				<a href="{{inbound_resource.complete_url | discussions_url}}"
					title="Discussions for «{% firstof inbound_resource.title inbound_resource.complete_url %}»">{{ inbound_resource.discussions_comment_count }}
					comments</a>

				<!-- <p>{{inbound_resource.discussions_normalized_tags}}</p> -->

			</li>
			{% endfor %}
		</ul>
	</div>
	{% endif %}



	{% if ctx.submit_links %}
	<div class='submit_links'>
		<br />
		<details {% if ctx.submit_links_visible %}open{% endif %}>
			<summary>Submit link to:</summary>
			<ul>
				{% for submit_platform, submit_link in ctx.submit_links.items %}
				<li>
					<a href="{{submit_link}}" title="Submit to {{submit_platform}}" rel="nofollow noreferrer noopener"
						target="_blank">{{submit_platform}}</a>
				</li>
				{% endfor %}
			</ul>
		</details>
	</div>
	{% endif %}

	{% if ctx.try_with_site_prefix or ctx.try_with_title %}

	<details {% if ctx.nothing_found %}open{% endif %}>
		<summary>Related searches:</summary>

		{% if ctx.try_with_site_prefix %}
		<p>Try searching the whole domain: <a
				href="{{ctx.try_with_site_prefix|discussions_url}}">{{ctx.try_with_site_prefix}}</a></p>
		{% endif %}

		{% if ctx.try_with_title %}
		<p>Try searching with title: <a href="{{ctx.try_with_title|discussions_url}}">{{ctx.try_with_title}}</a></p>
		{% endif %}

		{% if ctx.try_with_url %}
		<p>Try searching with url: <a href="{{ctx.try_with_url|discussions_url}}">{{ctx.try_with_url}}</a></p>
		{% endif %}

	</details>

	{% endif %}

	<!-- {% if ctx.display_discussions and not ctx.nothing_found %}
	<aside>
		<br />
		<div class="donate">
			<p><a href="https://xojoc.pw/donate" rel="nofollow" title="Support discu.eu's development">Donate</a></p>
		</div>
	</aside>
	{% endif %} -->

</div>
{% endblock main %}