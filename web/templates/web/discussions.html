{% extends "web/base.html" %}

{% load humanize %}
{% load util %}
{% load static %}

{% block title %}
{% if ctx.title or ctx.original_query %}
{% firstof ctx.title ctx.original_query %} - discu.eu
{% else %}
Discussions around the Web - discu.eu
{% endif %}
{% endblock title %}

{% block meta_description %}
{% if ctx.title or ctx.original_query %}
Discussions and related articles for {% firstof ctx.title ctx.original_query %}
{% else %}
Find interesting discussions on Hacker News, Reddit and Lobsters for a given URL, title or keyword
{% endif %}
{% endblock meta_description %}

{% block extra_head %}
{% if ctx.link_canonical_url %}
<link rel="canonical" href="{{ctx.link_canonical_url}}" />
{% endif %}
{% endblock extra_head %}


{% block main %}

<div id=discussions>
	<form method="GET" class="discussions_form" action="/">
		<div class="d-flex flex-row flex-wrap gap-2">
			<input class="flex-fill" id="q" name="q" type="text" autofocus
				onfocus="this.selectionStart = this.selectionEnd = this.value.length;" value="{{ctx.original_query}}"
				placeholder="URL or title" />
			<input type="submit" value="Lookup" class="btn btn-primary" />
		</div>
	</form>

	<div class="my-4"></div>


	<!--
	 SQL query:

	 {{ctx.sql_query}}
    -->

	{% if ctx.nothing_found %}
	<h4>Discussions not found</h4>
	<p>Sorry, we couldn't find nothing for <span class="bold">{{ctx.url}}</span></p>
	{% else %}

	{% if ctx.display_discussions %}


	{% for platform, platform_name, platform_url, platform_tag_url, discussions in ctx.grouped_discussions %}
	<div id="platform_{{platform}}" class="platform_discussions">
		<h6>{{ platform_name }}</h6>
	</div>
	<ul class="list-unstyled">
		{% for d in discussions %}
		<li class="mb-2">
			<a href="{{d.story_url}}" title="{{d.title}}" class="d-flex flex-column text-body">
				{{d.title}}
				<span class="d-inline-block smaller-font url-max-width text-truncate">{{d.story_url}}</span></a>
			<a href="{{d.discussion_url}}"
				title="View discussion with {{d.score}} {{d.score_label}} on {{platform_name}}"
				rel="nofollow"><strong>{{d.comment_count}}
					comment{{d.comment_count|pluralize:",s"}}</strong></a>
			<span class="smaller-font"><time
					datetime="{{d.created_at | date:'c'}}">{{d.created_at | date}}</time></span>
			<span class="smaller-font">
				{% if d.tags %}
				{% if platform != 'r' %}
				{% endif %}
				{% for tag in d.tags %}
				{{tag}}{% if not forloop.last %}, {% endif %}
				{% endfor %}
				{% endif %}
			</span>

			<!--Id: {{d.platform_id}}
		 Normalized tags: {{d.normalized_tags}}
		 Normalized title: {{d.normalized_title}}
		 Canonical url: {{d.canonical_story_url}}
	    -->
		</li>

		{% endfor %}
	</ul>
	{% endfor %}



	{% else %}

	<h5 class="mt-5">What is discu.eu?</h5>
	<p>discu.eu tracks and makes accessible discussions on Hacker News, Lobsters, Reddit, Lambda the
		Ultimate and <a href="/statistics#platforms" title="Platforms">others</a>.
	</p>

	<h5>How to use</h5>
	<ul>
		<li><a href="{% url 'web:search' %}" title="How to search">Search by url or keyword</a></li>
		<li>Follow us on <a href="/social" title="Social accounts">Twitter or Mastodon</a> for daily updates on
			topics
			you care about</li>
		<li>Subscribe to the <a href="/weekly" title="Weekly newsletter">weekly newsletter</a> to get the latest on
			topics you
			care about</li>
		<li>Install the <a href="/extension" title="Browser extension">browser extension</a> to view discussions for the
			pages you visit (or use the <a href="/bookmarklet" title="Bookmarklet">bookmarklet</a>)</li>
		<li>Display comments on your <a href="/website" title="Display comments on your website">website</a></li>
		<li>Use the <a href="/api/v0/docs" title="Discussions API">API</a></li>
	</ul>

	{% endif %}

	{% endif %}



	<!-- Resource id: {{ctx.resource.id}} -->

	{% if ctx.inbound_resources %}
	<div class="my-5"></div>
	<h6>Related pages</h6>

	<div class="inbound_links">
		<ul class="list-unstyled">
			{% for inbound_resource in ctx.inbound_resources %}
			<!-- Inbound resource id: {{inbound_resource.id}} -->
			<li class="mb-2"><a href="{{inbound_resource.complete_url}}"
					title="{% firstof inbound_resource.title inbound_resource.complete_url %}" rel="nofollow"
					class="d-flex flex-column text-body">
					{{inbound_resource.title}}
					<span
						class="d-inline-block smaller-font url-max-width text-truncate">{{inbound_resource.complete_url}}</span>
				</a>

				<a href="{{inbound_resource.complete_url | discussions_url}}"
					title="Discussions for «{% firstof inbound_resource.title inbound_resource.complete_url %}»">
					<strong>{{ inbound_resource.discussions_comment_count }}
						comment{{inbound_resource.discussions_comment_count|pluralize:",s"}}</strong>
				</a>
			</li>
			{% endfor %}
		</ul>
	</div>
	{% endif %}



	{% if ctx.submit_links %}
	<div class='submit_links mt-5'>
		<details {% if ctx.submit_links_visible %}open{% endif %}>
			<summary>Submit link to:</summary>
			<ul>
				{% for submit_platform, submit_link in ctx.submit_links.items %}
				<li>
					<a href="{{submit_link}}" title="Submit to {{submit_platform}}" rel="nofollow noreferrer noopener"
						target="_blank">{{submit_platform}}</a>
				</li>
				{% endfor %}
			</ul>
		</details>
	</div>
	{% endif %}

	{% if ctx.try_with_site_prefix or ctx.try_with_title %}

	<details {% if ctx.nothing_found %}open{% endif %} class="related-searches">
		<summary>Related searches:</summary>

		{% if ctx.try_with_site_prefix %}
		<p class="mb-1 ms-3">Try searching the whole domain: <a href="{{ctx.try_with_site_prefix|discussions_url}}"
				title="Discussions for «{{ctx.try_with_site_prefix}}»">{{ctx.try_with_site_prefix}}</a></p>
		{% endif %}

		{% if ctx.try_with_title %}
		<p class="mb-1 ms-3">Try searching with title: <a href="{{ctx.try_with_title|discussions_url}}"
				title="Discussions for «{{ctx.try_with_title}}»">{{ctx.try_with_title}}</a></p>
		{% endif %}

		{% if ctx.try_with_url %}
		<p class="mb-1 ms-3">Try searching with url: <a href="{{ctx.try_with_url|discussions_url}}"
				title="Discussions for «{{ctx.try_with_url}}»">{{ctx.try_with_url}}</a></p>
		{% endif %}

	</details>

	{% endif %}

</div>


{% endblock main %}